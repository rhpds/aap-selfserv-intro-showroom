= Configure Ansible Automation Platform for Self Service Portal

== Environment background

In your environment you will have access to the following:

* `Ansible Automaiton Platform.` It is set up with users, inventories, credentials, a project, and a number of job templates, all of which will be used in this lab.

* `Self-service automation portal.` You will perform the setup in AAP, and in Self-service portal to enable different user personas to leverage automation.

* `OpenShift Container Platform.` You will have access but you will not need to use it.

[#aaprbac]
== Configuring RBAC in AAP 2.6 that will be used for Self Service portal

=== Log in to the `Ansible Automation Platform` with the `admin` user, and the password provided for your AAP instance.

=== Create 3 teams in AAP:

Expand the `Access Management` menu on the left.

`Access Management` -> `Teams` -> `+Create Team`.

* `cloud-team`
* `network-team`
* `rhel-team`

Create each team as follows and click `Create team` to save the team(s).

image::createteam.png[]

Now that you have created the teams, you will assign roles and users to the teams.

Starting with the `cloud-team`:
`Access Management` -> `Teams` -> `cloud-team` -> `Roles` -> `+Assign roles`

image::assignroles.png[]

. In the `Assign roles` step one, select `Job Template` as the resource type, and click `Next`.
. In step 2, select all the job templates that begin with `Cloud/AWS`, and click `Next`.
. In step 3, select the role to apply, please select `Job Template Execute`, and click `Next`.
. In step 4, review your work, and click `Finish`.

image::selectjobtemplates.png[]
image::finish1strole.png[]

Repeat the same process for assiging roles by adding the following roles:

* Resource Type: `Inventory` -> `Next` -> select `Inventory Use` as the role to apply -> Review your work and click `Finish`
* Resource Type: `Credential` -> `Next` -> select `Credential Use` as the role to apply -> Review your work and click `Finish`

For `Inventory Use`, select the follwoing 3 inventories and click `Next`.

* `AWS Inventory`
* `Azure Inventory`
* `GCP Inventory`

For `Credential Use`, select the following 3 credentials and click `Next`.

* `AWS Credential`
* `Azure Credential`
* `RHEL - SSH Credentials`

While still on the `cloud-team` page, assign the following `Users` to the `cloud-team`:

* Click on the `Users` tab, and select `+Assign users` -> select the `clouduser1`, and click `Assign users`.

**Repeat the same process for role and user assignmens to the `network-team` and `rhel-team` teams.**

For `network-team`, assign the following:

* For Resource Type: `Job Template`, select all the job templates that begin with `Network/`, and click `Next`. Please select `Job Template Execute` as the role to apply -> Review your work and click `Finish`

* For Resource Type: `Inventory`, select the `Network Inventory` and click `Next`. Please select `Inventory Use` as the role to apply -> Review your work and click `Finish`

* For Resource Type: `Credential`, select the `Network Credential` and click `Next`. Please select `Credential Use` as the role to apply -> Review your work and click `Finish`

While still on the `network-team` page, assign the following `Users` to the `network-team`:

* Click on the `Users` tab, and select `+Assign users` -> select the `networkuser1`, and click `Assign users`.

For `rhel-team`, assign the following:

* For Resource Type: `Job Template`, select all the job templates that begin with `Linux/RHEL`, AND add 2 other job templates named `Cloud/AWS Create RHEL10 instance` and `Cloud/AWS Create RHEL9 instance` and click `Next`. Please select `Job Template Execute` as the role to apply -> Review your work and click `Finish`

* For Resource Type: `Inventory`, select the `RHEL Inventory` and click `Next`. Please select `Inventory Use` as the role to apply -> Review your work and click `Finish`

* For Resource Type: `Credential`, select the `AWS Credential` AND `RHEL - SSH Credentials` and click `Next`. Please select `Credential Use` as the role to apply -> Review your work and click `Finish`

While still on the `rhel-team` page, assign the following `Users` to the `rhel-team`:

* Click on the `Users` tab, and select `+Assign users` -> select the `rheluser1`, and click `Assign users`.

Awesome! You have now configured RBAC in Ansible Automation Platform.

[#ssprbac]
== Configure RBAC in Self Service portal


. Now that the yum repositories are defined within the container, execute 
another `yum install`, within the container, to install the target
software: `moon-buggy`.

+
[source,bash]
----
buildah run ubi-working-container -- yum -y install moon-buggy
----


=== Committing the Container Image

. At this point, the container is configured.  It is time to transition from a
working container into a committed image.  In the command below, you will use
the `buildah` command to commit the working container to an image called:
`moon-buggy`.



=== Deploy the Container

Now the software has been installed and a new container image created.  It is
time to spawn a runtime of the container image and validate the software.  The
software we are using is a command line command.  

. When you `run` the container,
it will be in interactive (`-it`) mode, based on the `moon-buggy` container
image and the command run interactively will be `/usr/bin/moon-buggy`.




[#validate]
== Validate content synchronization to Self Service portal


. Now that the yum repositories are defined within the container, execute 
another `yum install`, within the container, to install the target
software: `moon-buggy`.




=== Committing the Container Image

. At this point, the container is configured.  It is time to transition from a
working container into a committed image.  In the command below, you will use
the `buildah` command to commit the working container to an image called:
`moon-buggy`.
